<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mch</title>
  <!-- ä½¿ç”¨å°ç«è½¦ emoji ä½œä¸º favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš‚</text></svg>">
  <link rel="stylesheet" href="css/style.css">
  <script src="img/images.js"></script> <!-- Load image manifest before main script -->
  <style>
    /* å…¨å±æ–‡è‰ºæŸ”å’Œé£æ ¼è¦†ç›–æ ·å¼ */
    :root {
        /* æŸ”å’Œçš„è«å…°è¿ªè‰²ç³» / çº¸å¼ è´¨æ„Ÿé…è‰² */
        --bg-color: #f5f2e9;   /* ç±³ç™½/æš–ç°ï¼Œåƒæ—§ä¹¦é¡µ */
        --text-color: #4a4a4a; /* æ·±ç°ï¼Œä¸å¦‚çº¯é»‘åˆºçœ¼ */
        --accent-color: #8c9ea3; /* ç°è“ï¼Œä½é¥±å’Œåº¦ */
        --border-color: #e0ddd5;
        --nav-hover: #6b7c85;
    }

    body {
        font-family: "Optima", "Palatino", "Georgia", serif; /* ä¼˜é›…çš„è¡¬çº¿/äººæ–‡ä¸»ä¹‰æ— è¡¬çº¿å­—ä½“ */
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ */
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* å‚ç›´åˆ†å¸ƒï¼šå¤´-ä¸­-è„š */
    }
    
    /* é¡¶éƒ¨å¸ƒå±€ï¼šç´§å‡‘ä¸”ä¼˜é›… */
    header {
        padding: 1.5rem 2rem;
        display: flex;
        justify-content: space-between; /* å·¦å³åˆ†å¼€ */
        align-items: center;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        border-bottom: 1px solid transparent; /* ç§»é™¤åŸæ¥çš„è¾¹æ¡†æ„Ÿ */
        flex: 0 0 auto; /* ä¸ä¼¸ç¼© */
    }
    
    .logo {
        font-family: "Playfair Display", serif;
        font-size: 2rem;
        font-weight: 700;
        color: #2c3e50;
        letter-spacing: 0.05em;
        margin: 0;
    }
    
    /* ç§»é™¤ä¹‹å‰çš„è£…é¥°çº¿ */
    .logo::after { display: none; }

    nav {
        display: flex;
        gap: 2rem;
    }

    nav a {
        color: var(--accent-color);
        font-size: 0.95rem;
        font-weight: 500;
        text-transform: capitalize; /* é¦–å­—æ¯å¤§å†™ï¼Œæ¯”å…¨å¤§å†™æ›´æŸ”å’Œ */
        letter-spacing: 0.05em;
        text-decoration: none;
        transition: all 0.3s ease;
        position: relative;
        margin: 0;
    }

    nav a:hover {
        color: var(--nav-hover);
    }
    
    /* ç®€å•çš„ä¸‹åˆ’çº¿åŠ¨æ•ˆ */
    nav a::after {
        content: '';
        position: absolute;
        width: 0;
        height: 1px;
        bottom: -4px;
        left: 0;
        background-color: var(--nav-hover);
        transition: width 0.3s ease;
    }
    nav a:hover::after {
        width: 100%;
    }
    
    /* æ ¸å¿ƒèˆå°ï¼šç»å¯¹å±…ä¸­ */
    .train-stage {
        flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: auto; /* é‡ç½®æœ€å°é«˜åº¦ */
        opacity: 0.95; /* å¾®é€æ„Ÿ */
    }
    
    /* èƒ¶ç‰‡æ¡†ä½“æ ·å¼è°ƒæ•´ - èå…¥æµ…è‰²èƒŒæ™¯ */
    .film-strip {
        box-shadow: 0 20px 60px rgba(0,0,0,0.15); /* æ›´è½»æŸ”çš„é˜´å½± */
        border: 8px solid #333; /* åƒä¸€ä¸ªç›¸æ¡† */
        background: #222;
        /* ä¿æŒä¹‹å‰çš„ç¼©æ”¾ï¼Œä½†å¯èƒ½éœ€è¦æ ¹æ®å±å¹•å¾®è°ƒï¼Œæš‚æ—¶ä¿æŒ 1.5 */
        transform: scale(1.3); /* ç¨å¾®è°ƒå°ä¸€ç‚¹ä»¥å…æ’‘ç ´å°å±å¹• */
    }
    
    /* åº•éƒ¨ä¿¡æ¯ */
    .footnote {
        border-top: none;
        text-align: center;
        font-size: 0.8rem;
        color: #999;
        padding: 1rem;
        margin: 0;
        flex: 0 0 auto;
    }
    
    .footnote a {
        color: #888;
        text-decoration: none;
        transition: color 0.2s;
    }
    .footnote a:hover { color: var(--nav-hover); }

    /* å“åº”å¼å¾®è°ƒ */
    @media (max-height: 800px) {
        .film-strip { transform: scale(1.1); }
        .logo { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Mch</div>
    <nav>
      <a href="/">Home</a>
      <a href="article/">Articles</a>
      <a href="#about">About</a>
    </nav>
  </header>

  <section class="train-stage">
    <div class="film-strip">
      <div class="film-screen">
        <div class="scenery-container"></div>
        <div class="train-wrapper">
          <div class="train">
            <div class="train-cabin">
                <div class="train-window"></div>
            </div>
            <div class="train-body"></div>
            <div class="train-plate"></div>
            <div class="train-chimney"></div>
            <div class="train-cowcatcher"></div>
            <div class="train-chassis"></div>
            
            <div class="train-wheel w1"></div>
            <div class="train-wheel w2"></div>
            <div class="train-wheel w3"></div>

            <div class="smoke s1"></div>
            <div class="smoke s2"></div>
          </div>
          
          <div class="train-link"></div>
          
          <div class="train-carriage">
              <div class="carriage-body"></div>
              <div class="carriage-window cw1"></div>
              <div class="carriage-window cw2"></div>
              <div class="carriage-window cw3"></div>
              <div class="carriage-wheel w1"></div>
              <div class="carriage-wheel w2"></div>
          </div>
        </div>
        <div class="track"></div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /* Train Logic Disabled
      // --- Train Logic Restored ---
      const wrapper = document.querySelector('.train-wrapper');
      
      // Initial offset for the first added carriage
      // Static Car 1 starts at 305px.
      // Gap logic (25px gap): 
      // Step = Body(220) + Gap(25) = 245.
      // Next Car Pos = 305 + 245 = 550.
      let lastRightPos = 550; 

      function addCarriage() {
         // Create Link
         const link = document.createElement('div');
         link.className = 'train-link';
         // Link needs to overlap previous body by 10px.
         // Link Width 45. Gap 25. Overlap Next 10.
         // Relative to Next Car (lastRightPos): -35px.
         link.style.left = (lastRightPos - 35) + 'px'; 
         wrapper.appendChild(link);

         // Create Carriage
         const carriage = document.createElement('div');
         carriage.className = 'train-carriage';
         carriage.style.left = lastRightPos + 'px';
         
         carriage.innerHTML = `
              <div class="carriage-body"></div>
              <div class="carriage-window cw1"></div>
              <div class="carriage-window cw2"></div>
              <div class="carriage-window cw3"></div>
              <div class="carriage-wheel w1"></div>
              <div class="carriage-wheel w2"></div>
         `;
         wrapper.appendChild(carriage);

         // Update position for next one
         // Body(220) + Gap(25) = 245
         lastRightPos += 245; 
         
         // Limiter to prevent infinite DOM growth invisible off-screen
         if (wrapper.children.length > 20) {
             // Just stop adding or remove old? 
             // Since they grow to the left (negative visual space), 
             // eventually they are far off screen.
             // We can just keep adding or better, stop adding after some length.
             // But user likes infinite train. Let's keep adding but maybe remove?
             // Removing from DOM changes index. Logic relies on append.
             // Let's just limit to 20 carriages for performance, it's enough visual fill.
             // Actually, if we stop adding, the "shake" animation continues.
             // Let's just keep adding for now, it's a toy.
         }
      }

      // Initial carriages
      for (let i = 0; i < 3; i++) {
          addCarriage();
      }

      // Continue adding
      setInterval(addCarriage, 2000);
      */

      // --- Stations & Scenery Logic ---
      const filmScreen = document.querySelector('.film-screen');
      const sceneryContainer = document.querySelector('.scenery-container');
      
      // Generate 35 images: shanhai_1.jpg to shanhai_35.jpg
      /* Hardcoded list generation removed
      const allImages = [];
      for(let i=1; i<=35; i++) {
        allImages.push(`img/shanhai_${i}.jpg`);
      }
      */
      
      let allImages = [];

      // Image selection logic: ensure no repeats in the last 10 images
      let recentImages = []; // Queue to store last 10 used indices
      
      function getNextImage() {
          if (allImages.length === 0) return ''; // Safely handle empty

          let randomIndex;
          let attempts = 0;
          
          do {
             randomIndex = Math.floor(Math.random() * allImages.length);
             attempts++;
          } while (recentImages.includes(randomIndex) && attempts < 100);
          
          // Update queue
          recentImages.push(randomIndex);
          if (recentImages.length > 10) {
              recentImages.shift(); // Remove oldest
          }
          
          return allImages[randomIndex];
      }

      // --- 1. Continuous Background Scenery ---
      // We want scenery to clear Screen (640px) in 5 seconds -> matching speed.
      // Normal animation: start 640 -> end -640. Duration 10s.
      // Initial animation: start 0 -> end -640. Duration 5s.
      
      function addScenery(isInitial = false) {
          const item = document.createElement('div');
          item.className = 'scenery-item';
          
          const imgSrc = getNextImage();
          if (imgSrc) {
             item.innerHTML = `<img src="${imgSrc}" alt="bg">`;
          } else {
             // Fallback color if no image loaded yet
             item.style.backgroundColor = '#222';
          }
          
          if (isInitial) {
              item.style.animation = 'scenery-scroll-initial 5s linear forwards';
          } else {
              item.style.animation = 'scenery-scroll 10s linear forwards';
          }
          
          sceneryContainer.appendChild(item);
          
          // Cleanup
          setTimeout(() => {
              if (item.parentNode) item.parentNode.removeChild(item);
          }, 11000); 
      }

      // Initialize Logic
      function initScenery() {
          // Try to get images from global variable set by images.js
          if (window.manifestImages && window.manifestImages.length > 0) {
              allImages = window.manifestImages;
              console.log('Loaded images from JS manifest:', allImages.length);
          } else {
              console.warn('window.manifestImages not found or empty.');
          }

          /* Removed fetch logic to avoid CORS/File protocol issues
          try {
            const response = await fetch('img/images.json'); 
            ...
          }
          */

          if (allImages.length === 0) {
              console.warn("No images found. Please check img/images.js");
              // Fallback for visual debugging only if absolutely needed, or leave blank
          }

          // Start Animation Loop
          addScenery(true); 
          addScenery(false); 
          
          setInterval(() => {
              addScenery(false);
          }, 5000);
      }
      
      initScenery();

      /* Previously called directly:
      addScenery(true); 
      addScenery(false); 
      setInterval(...)
      */

    });
  </script>
  <section id="about" class="footnote">
    <div>Created By MchWang. | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">é™•ICPå¤‡17021455å·</a></div>
  </section>
</body>
</html>
