<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mch</title>
  <!-- ä½¿ç”¨å°ç«è½¦ emoji ä½œä¸º favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš‚</text></svg>">
  <link rel="stylesheet" href="css/style.css">
  <script src="img/images.js"></script> <!-- Load image manifest before main script -->
  <style>
    /* æ–‡è‰ºé£æ ¼è¦†ç›–æ ·å¼ */
    body {
        font-family: "Merriweather", "Georgia", "Times New Roman", serif;
        background-color: #1a1a1a; /* æ›´æŸ”å’Œçš„æ·±è‰²èƒŒæ™¯ */
        color: #d4d4d4;
    }
    
    header {
        padding: 4rem 0 2rem;
        justify-content: center;
        flex-direction: column;
        border-bottom: none;
    }
    
    .logo {
        font-family: "Playfair Display", serif;
        font-size: 3rem;
        font-weight: 400;
        margin-bottom: 2rem;
        letter-spacing: 0.1em;
        position: relative;
    }
    
    /* è£…é¥°çº¿æ¡ */
    .logo::after {
        content: "";
        display: block;
        width: 40px;
        height: 1px;
        background: #555;
        margin: 1rem auto 0;
    }

    nav {
        display: flex;
        gap: 2rem;
    }

    nav a {
        color: #888;
        font-size: 0.9rem;
        font-weight: 400;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        transition: color 0.3s ease;
        margin: 0; 
    }

    nav a:hover {
        color: #fff;
    }
    
    /* è°ƒæ•´èƒ¶ç‰‡å®¹å™¨ä½ç½®ä½¿å…¶æ›´åè°ƒ */
    .train-stage {
        margin: 4rem 0;
    }
    
    .film-strip {
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        border: 1px solid #333;
    }
    
    /* éšè—åŸæœ‰çš„ footer æ ·å¼ï¼Œä½¿ç”¨æç®€é£æ ¼ */
    .footnote {
        border-top: none;
        text-align: center;
        font-size: 0.8rem;
        opacity: 0.5;
        margin-top: 4rem;
        font-family: sans-serif; /* åº•éƒ¨ä¿¡æ¯ä¿æŒæ¸…æ™° */
        font-weight: 300;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Mch</div>
    <nav>
      <a href="/">Home</a>
      <a href="article/">Articles</a>
      <a href="#about">About</a>
    </nav>
  </header>

  <section class="train-stage">
    <div class="film-strip">
      <div class="film-screen">
        <div class="scenery-container"></div>
        <div class="train-wrapper">
          <div class="train">
            <div class="train-cabin">
                <div class="train-window"></div>
            </div>
            <div class="train-body"></div>
            <div class="train-plate"></div>
            <div class="train-chimney"></div>
            <div class="train-cowcatcher"></div>
            <div class="train-chassis"></div>
            
            <div class="train-wheel w1"></div>
            <div class="train-wheel w2"></div>
            <div class="train-wheel w3"></div>

            <div class="smoke s1"></div>
            <div class="smoke s2"></div>
          </div>
          
          <div class="train-link"></div>
          
          <div class="train-carriage">
              <div class="carriage-body"></div>
              <div class="carriage-window cw1"></div>
              <div class="carriage-window cw2"></div>
              <div class="carriage-window cw3"></div>
              <div class="carriage-wheel w1"></div>
              <div class="carriage-wheel w2"></div>
          </div>
        </div>
        <div class="track"></div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /* Train Logic Disabled
      // --- Train Logic Restored ---
      const wrapper = document.querySelector('.train-wrapper');
      
      // Initial offset for the first added carriage
      // Static Car 1 starts at 305px.
      // Gap logic (25px gap): 
      // Step = Body(220) + Gap(25) = 245.
      // Next Car Pos = 305 + 245 = 550.
      let lastRightPos = 550; 

      function addCarriage() {
         // Create Link
         const link = document.createElement('div');
         link.className = 'train-link';
         // Link needs to overlap previous body by 10px.
         // Link Width 45. Gap 25. Overlap Next 10.
         // Relative to Next Car (lastRightPos): -35px.
         link.style.left = (lastRightPos - 35) + 'px'; 
         wrapper.appendChild(link);

         // Create Carriage
         const carriage = document.createElement('div');
         carriage.className = 'train-carriage';
         carriage.style.left = lastRightPos + 'px';
         
         carriage.innerHTML = `
              <div class="carriage-body"></div>
              <div class="carriage-window cw1"></div>
              <div class="carriage-window cw2"></div>
              <div class="carriage-window cw3"></div>
              <div class="carriage-wheel w1"></div>
              <div class="carriage-wheel w2"></div>
         `;
         wrapper.appendChild(carriage);

         // Update position for next one
         // Body(220) + Gap(25) = 245
         lastRightPos += 245; 
         
         // Limiter to prevent infinite DOM growth invisible off-screen
         if (wrapper.children.length > 20) {
             // Just stop adding or remove old? 
             // Since they grow to the left (negative visual space), 
             // eventually they are far off screen.
             // We can just keep adding or better, stop adding after some length.
             // But user likes infinite train. Let's keep adding but maybe remove?
             // Removing from DOM changes index. Logic relies on append.
             // Let's just limit to 20 carriages for performance, it's enough visual fill.
             // Actually, if we stop adding, the "shake" animation continues.
             // Let's just keep adding for now, it's a toy.
         }
      }

      // Initial carriages
      for (let i = 0; i < 3; i++) {
          addCarriage();
      }

      // Continue adding
      setInterval(addCarriage, 2000);
      */

      // --- Stations & Scenery Logic ---
      const filmScreen = document.querySelector('.film-screen');
      const sceneryContainer = document.querySelector('.scenery-container');
      
      // Generate 35 images: shanhai_1.jpg to shanhai_35.jpg
      /* Hardcoded list generation removed
      const allImages = [];
      for(let i=1; i<=35; i++) {
        allImages.push(`img/shanhai_${i}.jpg`);
      }
      */
      
      let allImages = [];

      // Image selection logic: ensure no repeats in the last 10 images
      let recentImages = []; // Queue to store last 10 used indices
      
      function getNextImage() {
          if (allImages.length === 0) return ''; // Safely handle empty

          let randomIndex;
          let attempts = 0;
          
          do {
             randomIndex = Math.floor(Math.random() * allImages.length);
             attempts++;
          } while (recentImages.includes(randomIndex) && attempts < 100);
          
          // Update queue
          recentImages.push(randomIndex);
          if (recentImages.length > 10) {
              recentImages.shift(); // Remove oldest
          }
          
          return allImages[randomIndex];
      }

      // --- 1. Continuous Background Scenery ---
      // We want scenery to clear Screen (640px) in 5 seconds -> matching speed.
      // Normal animation: start 640 -> end -640. Duration 10s.
      // Initial animation: start 0 -> end -640. Duration 5s.
      
      function addScenery(isInitial = false) {
          const item = document.createElement('div');
          item.className = 'scenery-item';
          
          const imgSrc = getNextImage();
          if (imgSrc) {
             item.innerHTML = `<img src="${imgSrc}" alt="bg">`;
          } else {
             // Fallback color if no image loaded yet
             item.style.backgroundColor = '#222';
          }
          
          if (isInitial) {
              item.style.animation = 'scenery-scroll-initial 5s linear forwards';
          } else {
              item.style.animation = 'scenery-scroll 10s linear forwards';
          }
          
          sceneryContainer.appendChild(item);
          
          // Cleanup
          setTimeout(() => {
              if (item.parentNode) item.parentNode.removeChild(item);
          }, 11000); 
      }

      // Initialize Logic
      function initScenery() {
          // Try to get images from global variable set by images.js
          if (window.manifestImages && window.manifestImages.length > 0) {
              allImages = window.manifestImages;
              console.log('Loaded images from JS manifest:', allImages.length);
          } else {
              console.warn('window.manifestImages not found or empty.');
          }

          /* Removed fetch logic to avoid CORS/File protocol issues
          try {
            const response = await fetch('img/images.json'); 
            ...
          }
          */

          if (allImages.length === 0) {
              console.warn("No images found. Please check img/images.js");
              // Fallback for visual debugging only if absolutely needed, or leave blank
          }

          // Start Animation Loop
          addScenery(true); 
          addScenery(false); 
          
          setInterval(() => {
              addScenery(false);
          }, 5000);
      }
      
      initScenery();

      /* Previously called directly:
      addScenery(true); 
      addScenery(false); 
      setInterval(...)
      */

    });
  </script>
  <section id="about" class="footnote">
    <div>Created By MchWang. | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">é™•ICPå¤‡17021455å·</a></div>
  </section>
</body>
</html>
